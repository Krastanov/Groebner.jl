
using AbstractAlgebra
using Primes

@testset "Hard testsets for f4" begin
    R, (x1, x2, x3, x4) = PolynomialRing(QQ, ["x1","x2","x3","x4"], ordering=:degrevlex)

    ###########################################################################

    N = prod(map(BigInt, nextprimes(2^31 - 1, 5)))
    #=
    N is
    45671930739135174346839766056203605080877915151
    =#
    system = [x1 + x2 + x3 + x4,
                x1*x2 + x1*x3 + x1*x4 + x2*x3 + x2*x4 + x3*x4,
                x1*x2*x3 + x1*x2*x4 + x1*x3*x4 + x2*x3*x4,
                x1*x2*x3*x4 + N]

    # this should take about 10 primes
    gb = Groebner.groebner(system)
    @test gb == [
        x1 + x2 + x3 + x4,
        x2^2 + x2*x3 + x3^2 + x2*x4 + x3*x4 + x4^2,
        x3^3 + x3^2*x4 + x3*x4^2 + x4^3,
        x4^4 - N
    ]

    ###########################################################################

    N = prod(map(BigInt, nextprimes(2^31 - 1, 100)))
    #=
    N is
    155957502472941350164396756181237870921673222084334376466764837248138019
    338975770533033341246052934841394539580063717875572166517749899185157089
    854972461613034435119695325890456903607183962279960193065823268162712808
    196475765998522398673229836351207189494171911844595858978617297329048837
    407198011154883771097567254734750443080714724501847550152215111049527862
    783487269833728445656312427565443863328011390695385168351099683848940890
    157184467093413854863172748020836886918109307797366132657049418890246023
    760683982046987711591165743318455570261741083133013563013142610260813314
    163528474356815207125941871425854964734919799177276840652608662771694654
    083164269078631636104073420379406434036790229905893357639334250840650980
    175594048478512395769709879899298769488161098605323126429857397027203991
    344047973029587500619268226785604632683477043132362736563551930698622928
    5368207467244436111610932456122141350383600941573123435631247362408683
    =#
    system = [x1 + x2 + x3 + x4,
                x1*x2 + x1*x3 + x1*x4 + x2*x3 + x2*x4 + x3*x4,
                x1*x2*x3 + x1*x2*x4 + x1*x3*x4 + x2*x3*x4,
                x1*x2*x3*x4 + N]
    # around 200 primes are required
    gb = Groebner.groebner(system)
    @test gb == [
        x1 + x2 + x3 + x4,
        x2^2 + x2*x3 + x3^2 + x2*x4 + x3*x4 + x4^2,
        x3^3 + x3^2*x4 + x3*x4^2 + x4^3,
        x4^4 - N
    ]

    ###########################################################################
    N = prod(map(BigInt, primes(2^30 + 2^29 + 2^28 + 2^27 + 2^26 + 2^25 + 2^24 + 2^23 + 2^22 + 2^21 + 2^20 + 2^19 + 2^18 + 2^17 + 2^16 + 2^15 + 2^14, 2^31-1)))
    #=
    N is
    39188369970332484219704030630868031557335670364453441693572856954118012583428920440497546093202167118039217580294654301661249920803742326224612318210514910575165827232290962643902652470596315153729060620375394724456354585092543862847915557873116375569991451329277152799505323218591353989916280522583944727755433080701955824696996707858453080792438200970504971038268684295470452387267528156901593886127024610454943579252004870233322141799555503723003890288580742035008224998184006512479260566165554533674419516379671701757642642447224917217511431591716329323123596609823555074930414429449454898101864640014558886548251159464095895768362292845128567532334180798553315896428663150560887210810330778215464988092556746879690452320474094647568314387166770472486580745111577173485674220216765311042599456127293358158388109938464694945261437951795289284537926616473252848402196245322146074058073660740149470575578809424773253507638050953290304559501304479505452830470875318775912905141504944783228997724364014638402905585525815060345484617133016978495437462417036812660895367942105159575882176711081907933987981680827303631242861170291195181291032700843582254148302202698889486648738780026839820993342108402918386943871267646874914564000594840403534719607005890109057351896684521063387316653135373429816019895367479648234814352912141140671962236343787406880825817105640709508268294392644266818423001042162284954689059491974892079916742012945121219260811353547458271809034078231083923650258301131545433319100436802211146556294511485048234813808642345387584938907096637297627744482893089349345878810955929718845661040373193536125523032564479951383634073211055156696477583561744328265117038344705413213559709012768296151783698508221350811664650258772253985967452705650776400564131701256576574041972740190598861911447954417616801516255037051381324485969676504430003639031169888370969708364757638536189589627885986553951084590974003415085091310184639611650389408655091809190242447029172130590424655020766226071889601715048305836158618985696728880697412743484862617058040938986407442969698155962601346708548933800420879811669323884199481355899269353694218745949996358732003078247090314679486885929697529923742604131091840937926403728084004570933972103022722269019386274494826263896554763998835461322292016317373859971133896421124386061132355824587889419614356694197067492601111845704886797642939355621023973314643303982261334383057449832766327667419940214840682857732754213583847828909537462056978048369768753444999704714355200142771732311174833051534622648960784118819648544864885924325890535232205958705422908648431460427742940606027088951734131575166698758075572100723555830371261820704421970292141838904522518469688372914015468430679772563263722389569185097419185744249480495291805524825067744611540467625248703365594269241960870280590663380212513690641087373520744686647541261886907724450235101087718195069712883822953544026063086700926698478154349853337809076632123156491975026555280771768222966819166890027706345368808259264945073237511951858053241612163460343614733755932542887079560575701275344922868378620962953851501654682249621764608119550015459821736226261254541898200748091961570189372783791527856427084639614433472325321550788692307422674269326677143984623688062193567483241200626889836474281241381496310790356674377607572155308801485222905718985210582437231295356750195300766187478903309002069125170974680628651941834340334782581561054185640711742121355555469472088247208986615393965731089010355151115351178841439943461018365461999627202933769418774747005907175582494844599154340061918900301278431182614436154427690675063228481286043413864803547228824224686989339857373450580743899068344125260792715399977492677437017515749995273650921812781736708396049762098022952798592977307225835093151960905524467665294045407082438693479345993093485937720902012190875746337798701774029657455829234342327645665287826514099827483436473220206794520408317948933421640245873330376997983413072787109925234711360682498481436704278996280734759087144324956862958879174113050903642230072145510444340944280750164921725942948688873583720730315490992901971203496537628416438064532707162425880458767789556193564322078760139040575361906447060488894647895628740903079188787242556856292873215834016555642333068878207681832750561014808211283027592977909498601774064488990389899167659154957674639887337370143765606330681405572539533679679101621303697304630550717592898293721570078134811215305225808755303290760297008347052644548319314209153424856036798832977426205466230087817069941966786370492535767670346375397602172449814238843517060304631722306017139635926962838994410452286599430793747057342306316579165517496934988283485995435942295887723615909264209487566664902759135274365135278707265508968144264852385556911148595444514414199137590991648542912318079124649650102674723564771620457292213027261445452966220652897806389215503387554327884325112339769238380547120228254317287171776653521954694254664414356069521570317344314694030542181844334459478398452135333453314895851024657307461886926777139987581072392001642024459332283363523392871958704099350712945831925229613476732029223733963982407066639248975754698016450856076838434315040746051376680972589233845526599927349332194932892945971712535409747404180825870415326158865798164152788141207662080474308897716490595254138617942161090331308991651646293373625593379606970756291286075029124289923409051493979996940718532798389440619429506887128647622498773813099929812192768710875406813166208675792681620320679324355307947443375677328378162901730905893080709249025647867553350689753483078921640494313658261666995428134045982701136032314965953795572077865048504618258104139427928465529153735605631271231079617905728088640024949302051116633693415274728328080516527944945791456428334477826708915067478419768481919469702182808313547428054496618301158411557546248300079835729612473285974491890822452395577093851736028046344807654423196255209892912420707200842094018163997805261973696741105697511846217461175057879005260540786166297908560864440835532956453605144942763588881518487527637698962627887451317908392128014236401316984735189342068653391170344932502436398471609620069473698358877211871969507993283937954715646820759484457510004694142261173681718130520764312196207557682604527500809478419818007577669679421774847317829206797045700381203700267588765811050591326350654187919213782746148548701533026984440811370924847365596770153520058662489042792626561690763503075968052949931566819558702967056815675827685730030773571388821517866303628390975985255547108956036417287098707184706985988171474360610206120979062183020349590448430588203033050472583606619426489449759262439582693580117327408051092564030994948188231642424636225744895106806650916119586272049918167048246963028076253834485089659697561229073350111649652497142136384680894761694810249097154156285145189555777658298228856371100845315703963198611736586985078900565809455430221735949195115815029893709350083386314168485327662366974656355140684784659844947590429590996566913084999004596236392493588717196083000082087017044301660865920143743734928945281557
    =#

    # this should take A LOT of primes
    system = [x1 + x2 + x3 + x4,
                x1*x2 + x1*x3 + x1*x4 + x2*x3 + x2*x4 + x3*x4,
                x1*x2*x3 + x1*x2*x4 + x1*x3*x4 + x2*x3*x4,
                x1*x2*x3*x4 + N]
    # impossible to compute for now TODO
    # UPD1: almost done
    gb = Groebner.groebner(system)
    @test gb == [
        x1 + x2 + x3 + x4,
        x2^2 + x2*x3 + x3^2 + x2*x4 + x3*x4 + x4^2,
        x3^3 + x3^2*x4 + x3*x4^2 + x4^3,
        x4^4 - N
    ]
end
